-- ============================================================
-- Update Admin/Team Invite Email Template
-- ============================================================
--
-- This migration updates the user-invite-admin template to use
-- a dynamic ${accessListHtml} variable instead of hardcoded
-- access items. This allows role-specific access descriptions
-- to be shown in the invite email.
--
-- Roles and their access:
--   - super_admin: Full admin dashboard, user/team management, system settings
--   - admin: Full admin dashboard, client/user management, analytics
--   - production_team: Content workflow, content review tools, production dashboard
--   - sales: Sales pipeline, client onboarding, revenue reporting
-- ============================================================

UPDATE public.email_templates
SET
  body_html = E'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Portal Invitation</title>\n</head>\n<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, ''Segoe UI'', Roboto, ''Helvetica Neue'', Arial, sans-serif; background-color: #f5f5f5;">\n  <table role="presentation" style="width: 100%; border-collapse: collapse;">\n    <tr>\n      <td align="center" style="padding: 40px 20px;">\n        <table role="presentation" style="max-width: 600px; width: 100%; border-collapse: collapse; background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">\n          <tr>\n            <td style="padding: 32px 40px 24px; text-align: center; background-color: #ffffff; border-radius: 12px 12px 0 0; border-bottom: 1px solid #e5e7eb;">\n              <img src="https://portal.pyrusdigitalmedia.com/pyrus-logo.png" alt="Pyrus Digital Media" style="height: 36px; width: auto; max-width: 160px;" />\n            </td>\n          </tr>\n          <tr>\n            <td style="padding: 40px;">\n              <h1 style="margin: 0 0 20px; font-size: 24px; font-weight: 600; color: #1A1F16; line-height: 1.3;">\n                Hi ${firstName},\n              </h1>\n              <p style="margin: 0 0 20px; font-size: 16px; color: #5A6358; line-height: 1.6;">\n                You''ve been invited to join the Pyrus Digital Media admin portal as <strong>${roleDisplay}</strong>.\n              </p>\n              <p style="margin: 0 0 30px; font-size: 16px; color: #5A6358; line-height: 1.6;">\n                Click the button below to set up your account and get started:\n              </p>\n              <table role="presentation" style="width: 100%; border-collapse: collapse;">\n                <tr>\n                  <td align="center">\n                    <a href="${inviteUrl}" style="display: inline-block; padding: 16px 32px; background-color: #324438; color: #ffffff; text-decoration: none; font-size: 16px; font-weight: 600; border-radius: 8px;">\n                      Set Up Your Account\n                    </a>\n                  </td>\n                </tr>\n              </table>\n              <p style="margin: 30px 0 0; font-size: 14px; color: #8B9088; line-height: 1.6;">\n                Or copy and paste this link into your browser:<br />\n                <a href="${inviteUrl}" style="color: #324438; word-break: break-all;">${inviteUrl}</a>\n              </p>\n              <p style="margin: 20px 0 0; font-size: 14px; color: #8B9088; line-height: 1.6;">\n                This link will expire in 7 days.\n              </p>\n            </td>\n          </tr>\n          <tr>\n            <td style="padding: 0 40px 40px;">\n              <table role="presentation" style="width: 100%; border-collapse: collapse; background-color: #F8FAF8; border-radius: 8px;">\n                <tr>\n                  <td style="padding: 24px;">\n                    <h3 style="margin: 0 0 16px; font-size: 14px; font-weight: 600; color: #324438; text-transform: uppercase; letter-spacing: 0.5px;">\n                      What You''ll Get Access To\n                    </h3>\n                    <table role="presentation" style="width: 100%; border-collapse: collapse;">\n                      ${accessListHtml}\n                    </table>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          <tr>\n            <td style="padding: 24px 40px; background-color: #F8FAF8; border-radius: 0 0 12px 12px; border-top: 1px solid #e5e7eb;">\n              <p style="margin: 0; font-size: 12px; color: #8B9088; line-height: 1.6; text-align: center;">\n                If you didn''t expect this invitation, you can safely ignore this email.\n              </p>\n              <p style="margin: 12px 0 0; font-size: 12px; color: #8B9088; line-height: 1.6; text-align: center;">\n                Pyrus Digital Media &bull; <a href="https://pyrusdigitalmedia.com" style="color: #324438;">pyrusdigitalmedia.com</a>\n              </p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>',
  available_variables = '[{"key": "firstName", "description": "Recipient''s first name", "example": "John"}, {"key": "roleDisplay", "description": "Human-readable role name", "example": "Admin"}, {"key": "inviteUrl", "description": "Account setup URL with invite token", "example": "https://portal.pyrusdigitalmedia.com/accept-invite?token=abc123"}, {"key": "inviterName", "description": "Name of person who sent the invite", "example": "Jane Smith"}, {"key": "accessListHtml", "description": "HTML table rows of role-specific access items (auto-generated based on role)", "example": "<tr><td>...</td></tr>"}]'::jsonb,
  updated_at = NOW()
WHERE slug = 'user-invite-admin';
